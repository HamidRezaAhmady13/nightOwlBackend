<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HLS Video Test</title>
    <style>
      body {
        background: #111;
        color: #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        font-family: sans-serif;
      }
      video {
        width: 80%;
        max-width: 800px;
        border: 2px solid #444;
        border-radius: 8px;
        margin-bottom: 10px;
      }
      select {
        padding: 6px 12px;
        background: #222;
        color: #eee;
        border: 1px solid #555;
        border-radius: 4px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h1>ðŸŽ¥ HLS Video Test</h1>
    <video id="video" controls></video>
    <label for="quality">Choose Quality:</label>
    <select id="quality"></select>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
      const video = document.getElementById('video');
      const qualitySelector = document.getElementById('quality');
      const hls = new Hls();

      const playlistUrl = '/uploads/1755548246442-hls/master.m3u8';

      if (Hls.isSupported()) {
        hls.loadSource(playlistUrl);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.play();
          console.log('Available levels:', hls.levels);

          // Populate quality options
          hls.levels.forEach((level, index) => {
            const option = document.createElement('option');
            const label = level.height
              ? `${level.height}p`
              : `${Math.round(level.bitrate / 1000)}kbps`;
            option.value = index;
            option.text = label;
            qualitySelector.appendChild(option);
          });

          // Set initial selection to auto
          const autoOption = document.createElement('option');
          autoOption.value = -1;
          autoOption.text = 'Auto';
          qualitySelector.insertBefore(autoOption, qualitySelector.firstChild);
          qualitySelector.value = -1;

          // Handle quality change
          qualitySelector.addEventListener('change', () => {
            const selectedLevel = parseInt(qualitySelector.value);
            hls.currentLevel = selectedLevel;
          });
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = playlistUrl;
        video.addEventListener('loadedmetadata', function () {
          video.play();
        });
        qualitySelector.style.display = 'none'; // Hide selector for native HLS
      } else {
        alert('HLS not supported in this browser.');
      }
    </script>
  </body>
</html>
